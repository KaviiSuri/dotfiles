{{ if eq .chezmoi.os "windows" -}}
:: -*-mode:bat-*- vim:ft=bat
@echo off

::
:: ~/.local/share/chezmoi/run_windows_terminal.bat: runs after `chezmoi apply`.
::
:: Copies Windows Terminal configuration file to final destination on Windows.
::

set SRCFILE=%USERPROFILE%\.config\windows_terminal.json
set DESTFILE=%LOCALAPPDATA%\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\profiles.json

:: Skip if application has not been installed.
FOR %%A in (%DESTFILE%) do (
    IF NOT EXIST %%~pA (
        exit 0
    )
)

:: Skip if destination is a symbolic link.
dir %DESTFILE% | find "<SYMLINK>" > nul
IF %errorlevel% == 0 (
    exit 0
)

:: Skip if configuration files are identical.
fc /b %SRCFILE% %DESTFILE% > nul
IF %errorlevel% == 0 (
    exit 0
)

:: Copy source file to destination.
xcopy /fvy %SRCFILE% %DESTFILE%*
{{- end }}
